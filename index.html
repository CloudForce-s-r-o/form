<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8" />
    <title>Seznámení s dokumenty</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1, h2 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #bbb;
            background: #fff;
        }
        th {
            background: #e6e6e6;
        }
        .hidden {
            display: none;
        }
        #confirmBtn {
            margin-top: 25px;
            padding: 12px 20px;
            font-size: 16px;
            background: #0066cc;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 6px;
        }
        #confirmBtn:hover {
            background: #004c99;
        }
        #errorMsg {
            color: red;
            font-weight: bold;
        }
    </style>
</head>

<body>
<h1>Seznámení s řízenou dokumentací</h1>
<div id="errorMsg"></div>

<div id="loading">Načítám data…</div>

<div id="content" class="hidden">
    <h2>Dokumenty čekající na seznámení</h2>
    <table id="pendingTable">
        <thead>
            <tr>
                <th>Název dokumentu</th>
                <th>Datum požadavku</th>
                <th>Odkaz</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>Dokumenty již seznámené</h2>
    <table id="doneTable">
        <thead>
            <tr>
                <th>Název dokumentu</th>
                <th>Datum požadavku</th>
                <th>Datum seznámení</th>
                <th>Odkaz</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <button id="confirmBtn" class="hidden">Potvrdit seznámení s dokumenty</button>
</div>

<script>
// ---------------------------
// 1️⃣ ZÍSKÁNÍ ID Z PARAMETRU
// ---------------------------
function getIdFromUrl() {
    const params = new URLSearchParams(window.location.search);
    return params.get("id");
}

const USER_ID = getIdFromUrl();

if (!USER_ID) {
    document.getElementById("errorMsg").innerText = "Chybí parametr ?id= v URL!";
}

// ---------------------------
// 2️⃣ NAČTENÍ DAT Z BACKENDU
// ---------------------------
async function loadData() {
    try {
        const res = await fetch("YOUR_URL_HERE", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id: USER_ID })
        });

        if (!res.ok) {
            throw new Error("Chyba komunikace s API.");
        }

        const data = await res.json();
        renderTables(data);
    } catch (e) {
        document.getElementById("errorMsg").innerText =
            "Nepodařilo se načíst data: " + e.message;
    }
}

loadData();

// ---------------------------
// 3️⃣ VYKRESLENÍ TABULEK
// ---------------------------
function renderTables(data) {
    document.getElementById("loading").classList.add("hidden");
    document.getElementById("content").classList.remove("hidden");

    const pendingTbody = document.querySelector("#pendingTable tbody");
    const doneTbody = document.querySelector("#doneTable tbody");

    pendingTbody.innerHTML = "";
    doneTbody.innerHTML = "";

    let hasPending = false;

    data.forEach(doc => {
        const row = document.createElement("tr");

        if (doc.datumSeznameni === "" || doc.datumSeznameni === null) {
            // čekající na seznámení
            hasPending = true;
            row.innerHTML = `
                <td>${doc.nazevSouboru}</td>
                <td>${doc.datumPozadavku}</td>
                <td><a href="${doc.odkazNaSoubor}" target="_blank">Otevřít dokument</a></td>
            `;
            pendingTbody.appendChild(row);
        } else {
            // již seznámené
            row.innerHTML = `
                <td>${doc.nazevSouboru}</td>
                <td>${doc.datumPozadavku}</td>
                <td>${doc.datumSeznameni}</td>
                <td><a href="${doc.odkazNaSoubor}" target="_blank">Otevřít dokument</a></td>
            `;
            doneTbody.appendChild(row);
        }
    });

    // ---------------------------
    // 4️⃣ ZOBRAZENÍ/ SKRYTÍ TLAČÍTKA
    // ---------------------------
    const btn = document.getElementById("confirmBtn");
    if (hasPending) {
        btn.classList.remove("hidden");
    } else {
        btn.classList.add("hidden");
    }
}

</script>
</body>
</html>
