<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Seznámení s dokumenty</title>
  <style>
    body { font-family: Arial; margin: 30px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 30px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background: #f0f0f0; }
    h2 { margin-top: 40px; }
    #loading { font-size: 18px; }
    #confirmBtn { padding: 12px 20px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>

<h1>Seznámení s dokumenty</h1>

<div id="loading">Načítám data…</div>

<div id="content" style="display:none;">
  <h2>Dokumenty k seznámení</h2>
  <table id="todoTable">
    <thead>
      <tr>
        <th>Název dokumentu</th>
        <th>Datum požadavku</th>
        <th>Odkaz na dokument</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Již seznámené dokumenty</h2>
  <table id="doneTable">
    <thead>
      <tr>
        <th>Název dokumentu</th>
        <th>Datum požadavku</th>
        <th>Datum seznámení</th>
        <th>Odkaz na dokument</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="confirmBtn" style="display:none;">Potvrdit seznámení s dokumenty</button>
</div>

<script>
const URL = "https://default8da5bad552c84f89bb8a7500a8e0e2.53.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/11e51341bef74744be4c93cae776fcdf/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=xmsWpFTdq319G3NqcGgUNE7lWh8jICKymOlyyUxZdS4";

async function loadData() {
    try {
        const response = await fetch(URL, { method: "POST" }); 
        const data = await response.json();

        document.getElementById("loading").style.display = "none";
        document.getElementById("content").style.display = "block";

        const todo = data.filter(x => !x.datumSeznameni);
        const done = data.filter(x => x.datumSeznameni);

        fillTodo(todo);
        fillDone(done);

        document.getElementById("confirmBtn").style.display = 
            todo.length > 0 ? "block" : "none";

    } catch (err) {
        document.getElementById("loading").innerText = "Chyba při načítání dat.";
    }
}

function fillTodo(list) {
    const tbody = document.querySelector("#todoTable tbody");
    list.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${item.nazevSouboru}</td>
            <td>${item.datumPozadavku}</td>
            <td><a href="${item.odkazNaSoubor}" target="_blank">Otevřít dokument</a></td>
        `;
        tbody.appendChild(tr);
    });
}

function fillDone(list) {
    const tbody = document.querySelector("#doneTable tbody");
    list.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${item.nazevSouboru}</td>
            <td>${item.datumPozadavku}</td>
            <td>${item.datumSeznameni}</td>
            <td><a href="${item.odkazNaSoubor}" target="_blank">Otevřít dokument</a></td>
        `;
        tbody.appendChild(tr);
    });
}

loadData();
</script>

</body>
</html>
